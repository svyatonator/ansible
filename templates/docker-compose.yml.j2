services:
  openclaw:
    image: "{{ openclaw_image }}"
    container_name: openclaw
    restart: unless-stopped
    user: "{{ openclaw_user }}"

    ports:
{% if openclaw_bind_localhost %}
      - "127.0.0.1:{{ openclaw_port }}:{{ openclaw_port }}"
{% else %}
      - "{{ openclaw_port }}:{{ openclaw_port }}"
{% endif %}

    volumes:
      - "{{ openclaw_home }}:{{ openclaw_container_data }}"
      - "{{ openclaw_workspace }}:/workspace"
      - "{{ openclaw_skills }}:/skills"

    environment:
      OPENCLAW_PORT: "{{ openclaw_port }}"
      OPENCLAW_HOME: "{{ openclaw_container_home }}"
      OPENCLAW_WORKSPACE: /workspace
      OPENCLAW_CONFIG: "{{ openclaw_container_data }}/openclaw.json"
{% if openclaw_gateway_token | length > 0 %}
      OPENCLAW_GATEWAY_TOKEN: "{{ openclaw_gateway_token }}"
{% endif %}
{% if openclaw_telegram_bot_token | length > 0 %}
      TELEGRAM_BOT_TOKEN: "{{ openclaw_telegram_bot_token }}"
{% endif %}
{% if opencode_api_key | length > 0 %}
      OPENCODE_API_KEY: "{{ opencode_api_key }}"
{% endif %}
{% if brave_api_key | default('') | length > 0 %}
      BRAVE_API_KEY: "{{ brave_api_key }}"
{% endif %}

{% if openclaw_command | length > 0 %}
    command: {{ openclaw_command | map('string') | list | to_json }}
{% endif %}
